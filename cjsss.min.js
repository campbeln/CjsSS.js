/*
CjsSS.js v0.5 (kk) http://opensourcetaekwondo.com/cjsss
(c) 2014 Nick Campbell cjsssdev@gmail.com
License: MIT
Thanks jscompress.com!
*/
(function(e,t,n){"use strict";var r=false,i="cjsss",s=/<script.*?>([\s\S]*?)<\/script>/gi,o={options:{selector:"["+i+"], [data-"+i+"]",optionScope:"json",expose:false,async:true,scope:"sandbox",crlf:"",d1:"/*{{",d2:"}}*/"},services:{},version:"v0.5 (kk)",data:{services:{},inject:{},cache:{}},process:function(){o.services.process.apply(this,arguments)},inject:function(){o.services.inject.apply(this,arguments)}},u=o.options,a=o.services,f=o.data.cache,l=o.data.inject;a.autorun=function(){if(u.selector){a.process(u.selector)}else{a.expose()}};a.dom=e.jQuery||function(e){try{return t.querySelectorAll(e)}catch(n){return[]}};a.expose=function(){if(!r){r=true;o=e[i]=a.extend(e[i],o);a.inject(i,o)}};a.extend=function(e){var t,n;e=a.is.obj(e)?e:{};for(t=1;t<arguments.length;t++){if(a.is.obj(arguments[t])){for(n in arguments[t]){if(arguments[t].hasOwnProperty(n)){e[n]=a.is.obj(arguments[t][n])?a.extend(e[n],arguments[t][n]):arguments[t][n]}}}}return e};a.get=function(e,t,n){var r=XMLHttpRequest||ActiveXObject,i;try{i=new r("MSXML2.XMLHTTP.3.0")}catch(s){}if(a.is.fn(n)){n={fn:n,arg:null}}if(i){i.onreadystatechange=function(){if(i.readyState===4){n.fn(i.status===200||i.status===0&&e.substr(0,7)==="file://",i.responseText,n.arg,i)}};i.open("GET",e,t);i.send()}else{n.fn(false,null,n.arg,i)}};a.is={str:function(e){return(typeof e==="string"||e instanceof String)&&e!==""},fn:function(e){return Object.prototype.toString.call(e)==="[object Function]"},obj:function(e){return e&&e===Object(e)&&!a.is.fn(e)},arr:function(e){return Object.prototype.toString.call(e)==="[object Array]"}};a.inject=function(e,t){var n=a.is.str(e);if(n){l[e]=t}return n};a.mixinFactory=function(e){return function(t,n){if(a.is.obj(t)){return(n?(a.is.str(n)?n:t._selector)+" {":"")+e+a.toCss(t,e)+e+(n?"}":"")}else{return""}}};a.toCss=function(e,t){var n,r,i="";for(n in e){if(e.hasOwnProperty(n)&&n!=="_selector"){r=e[n];n=n.replace(/([A-Z])/g,"-$1").toLowerCase();n=n.indexOf("-")===0?n.substr(1):n;if(a.is.obj(r)){i+=a.toCss(r,t)}else{i+=n+":"+r+";"+t}}}return i};a.hasAttribute=function(e){var t,n=e.attributes,r=false;return function(e){e=e.toLowerCase();for(t=0;t<n.length;t++){if(n[t].name.toLowerCase()===e){r=true;break}}return r}};a.newId=function(e){var t=Math.floor(Math.random()*1e3);e=e||i;while(document.getElementById(e+t)){t=Math.floor(Math.random()*1e3)}return e+t};a.process=function(e,n){function m(e,t){var r;if(!f[e]){r=a.evalFactory.context(p.scope);f[e]={id:e,css:t,options:a.evalFactory.create(d)(l),mode:r.mode,evaler:a.evalFactory.create(r.context)}}p=a.extend({},u,f[e].options,n);if(p.expose){a.expose()}a.inject("mixin",a.mixinFactory(p.crlf))}var r,s,o,l,c,h=[],p=a.extend({},u,n),d=p.optionScope,v=function(e,n,r){if(e){var i=t.createElement("style");i.type="text/css";i.setAttribute(r.attr,r.$link.getAttribute(r.attr)||"");r.$link.parentNode.replaceChild(i,r.$link);i.id=r.id;f[r.id].css=n;m(c);a.processCSS(i,p,a.processGetScripts(r.id))}};if(e){if(a.is.str(e)){h=a.dom(e)}else{h=e[0]&&e.length?e:[e]}}else if(a.is.str(p.selector)){h=a.dom(p.selector)}for(r=0;r<h.length;r++){s=h[r];s.hasAttribute=s.hasAttribute||a.hasAttribute(s);o=(s.hasAttribute("data-"+i)?"data-":"")+i;l=s.getAttribute(o)||"{}";c=s.id=s.id||a.newId();switch(s.tagName.toLowerCase()){case"style":{m(c,s.innerHTML);a.processCSS(s,p,a.processGetScripts(c));break};case"link":{m(c);a.get(s.href,p.async,{fn:v,arg:{$link:s,attr:o,id:c,o:p}});break};default:{if(!f[c]){f[c]={css:s.getAttribute("style"),options:a.evalFactory.create(d)(l.indexOf("{")===0?l:'{ "selector": "'+l+'" }')}}p=a.extend({},f[c].options,n);var g,y=a.dom(p.selector)[0],b=f[y.id];if(b){f[c].evaler=b.evaler;a.processCSS(s,a.extend({},u,b.options,f[c].options,n),a.processGetScripts(b.id),true)}else{a.warn("Unable to locate parent element for "+s)}}}}return h};a.processGetScripts=function(e){var t,n,r,i=f[e].mode,o=/<[\/]?script.*?>/gi,u=/<script.*?src=['"](.*?)['"].*?>/i,l=function(e,t,n){r[n]=e?t:""};if(!f[e].run||i==="l"||i==="t"){r=f[e].css.match(s)||[];f[e].run=true;for(n=0;n<r.length;n++){t=u.exec(r[n]);if(t&&t[1]){a.get(t[1],false,{fn:l,arg:n})}else{r[n]=r[n].replace(o,"")}}}return r||[]};a.processCSS=function(e,t,n,r){var i,o,u,a=e.id,c=f[a].css.replace(s,"").replace(new RegExp("/\\*"+t.d1,"g"),t.d1).replace(new RegExp(t.d2+"\\*/","g"),t.d2).split(t.d1);for(i=1;i<c.length;i++){o=c[i].split(t.d2);c[i]={i:n.push(o.shift())-1,s:o.join(t.d2)}}n=f[a].evaler(n,l);u=c[0];for(i=1;i<c.length;i++){u+=n[c[i].i]+c[i].s}if(r){e.setAttribute("style",u)}else{if(e.styleSheet){e.styleSheet.cssText=u}else{e.innerHTML=u}}};a.warn=function(e){var t=console;(t?t.warn||t.log:function(){})(i+": "+e)};o.data.services=a.extend({},a);if(a.is.obj(e[i])){if(a.is.fn(e[i].servicesFactory)){a.extend(a,e[i].servicesFactory(o))}a.extend(u,e[i].options)}a.evalFactory=a.evalFactory||n(e,t,a);a.autorun()})(window,document,function(fnLocalEvaler){return function($win,$doc,$services){function globalEvalFn(){return"try{return(function(g,Object){return((1,eval)('Object')===g?function(c){return(1,eval)(c);}:(window.execScript?function(c){return window.execScript(c);}:null));})(Object,{});}catch(e){return null}"}function context(e,t){if($services.is.str(e)){switch(e.substr(0,1).toLowerCase()){case"g":{return{context:$win,mode:"g"}};case"l":{return{context:null,mode:"l"}};case"t":{if(e==="thislocal"){var n=createSandbox();n.$sandbox.inContext=function(e){n.$sandbox.local.call(t,e)};return{context:n,mode:"l"}}return{context:t,mode:"t"}};case"j":{return{context:JSON.parse,mode:"j"}};default:{return{context:createSandbox(),mode:"s"}}}}else{return{context:e,mode:"t"}}}function merge(e,t){if($services.is.obj(t)){for(var n in t){if(t.hasOwnProperty(n)){e[n]=e[n]||t[n]}}}}function createSandbox(){var e,t=$doc.body||$doc.head||$doc.getElementsByTagName("head")[0],n=$doc.createElement("iframe");n.style.display="none";t.appendChild(n);e=n.contentWindow;e.document.write("<script>"+"window.$sandbox={"+"global: function(){"+globalEvalFn()+"}(),"+"local: function(s){return eval(s);}"+"};"+"parent=null;"+"</script>");e.document.close();return e}function factory(vContext,fnFallback){if($services.is.str(vContext)){vContext=context(vContext).context}fnFallback=$services.is.fn(fnFallback)?fnFallback:function(s){$services.warn("Unable to collect requested `eval`, defaulting to the local `eval`.");return vContext&&vContext.$sandbox&&$services.is.fn(vContext.$sandbox.local)?vContext.$sandbox.local(s):eval(s)};return function(e,t){var n,r=[],i=$services.is.arr(e),s={js:e,returnVals:r,inject:t,key:""};if(!i){s.js=e=[e]}if(vContext===JSON.parse){JSON.parse=JSON.parse||fnFallback;for(n=0;n<e.length;n++){r.push(JSON.parse(e[n]))}}else if(vContext===$win){if(!fnGEval){fnGEval=(new Function(globalEvalFn()))()||fnFallback}merge(vContext,t);for(n=0;n<e.length;n++){r.push(fnGEval(e[n]))}}else if($services.is.obj(vContext)){if(vContext.$sandbox){s=vContext.$sandbox.inContext||vContext.$sandbox.global||fnFallback;merge(vContext,t);for(n=0;n<e.length;n++){r.push(s(e[n]))}}else{fnLocalEvaler.call(vContext,s)}}else{fnLocalEvaler(s)}return i?r:r[0]}}var fnGEval;if(!$win.JSON){$win.JSON={parse:$win.jQuery?$win.jQuery.parseJSON:createSandbox().$sandbox.local}}return{create:factory,sandbox:function(e,t){return factory(createSandbox(),t)(e)},json:JSON.parse,createSandbox:createSandbox,context:context}}}(function(){if(arguments[0].inject){for(arguments[0].key in arguments[0].inject){if(arguments[0].inject.hasOwnProperty(arguments[0].key)){eval("var "+arguments[0].key+" = arguments[0].inject[arguments[0].key];")}}}while(arguments[0].js.length>0){arguments[0].returnVals.push(eval(arguments[0].js.shift()))}}))
